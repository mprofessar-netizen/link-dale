<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000000;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 10px;
            text-align: center;
        }

        /* Restart Button (Top Right) */
        #restart-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            z-index: 10;
        }

        /* Fake Video Player Box */
        #ad-player-box {
            width: 100%;
            max-width: 400px;
            height: 250px;
            background-color: #111;
            border: 2px solid #333;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
            background-image: url('https://img.icons8.com/ios-filled/100/444444/video.png'); 
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
        }

        #play-btn {
            background-color: #ff0000;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Timer Box */
        #timer-box {
            display: none;
            font-size: 20px;
            font-weight: bold;
            color: #ffcc00;
            margin-bottom: 20px;
            padding: 15px;
            background: #222;
            border-radius: 10px;
            border: 1px solid #444;
            width: 90%;
            max-width: 350px;
        }

        /* Status Messages */
        #status-text {
            color: #aaa;
            font-size: 14px;
            margin-top: 5px;
        }

        .error-text {
            color: #ff4444;
            font-weight: bold;
            display: block;
            margin-top: 5px;
        }

        /* Input Section */
        #input-section {
            display: none;
            width: 100%;
            max-width: 400px;
        }

        input {
            width: 80%;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #222;
            color: white;
            margin-bottom: 15px;
            font-size: 16px;
            outline: none;
            text-align: center;
        }

        button.submit-btn {
            background-color: #2481cc;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 90%;
        }
    </style>
</head>
<body>

    <button id="restart-btn" onclick="location.reload()">üîÑ Restart</button>

    <div id="ad-player-box" onclick="startAdFlow()">
        <button id="play-btn">‚ñ∂Ô∏è Play Video</button>
        <p id="player-msg" style="color: #777; margin-top: 10px;">Click to Verify</p>
    </div>

    <div id="timer-box">
        ‚è≥ Remaining: <span id="time">30</span>s
        <div id="status-text">Go to Ad Tab and wait...</div>
    </div>

    <div id="input-section">
        <h3 style="color: #4CAF50;">‚úÖ Task Verified!</h3>
        <input type="text" id="userLink" placeholder="Paste Telegram Link here...">
        <br>
        <button class="submit-btn" onclick="submitLink()">üöÄ Submit Link</button>
    </div>

    <script>
        // --- CONFIGURATION ---
        const BOT_USERNAME = "Baymaxl_bot"; 
        const ADSTERRA_LINK = "https://www.effectivegatecpm.com/dhgty15yfe?key=68374b26e438b0e7cca7ba36137eafd2";
        const REQUIRED_TIME = 30; // Seconds

        // Elements
        const playerBox = document.getElementById("ad-player-box");
        const playBtn = document.getElementById("play-btn");
        const timerBox = document.getElementById("timer-box");
        const timeSpan = document.getElementById("time");
        const statusText = document.getElementById("status-text");
        const inputSection = document.getElementById("input-section");
        const restartBtn = document.getElementById("restart-btn");

        let isAdStarted = false;
        let endTime = 0;
        let timerInterval;

        function startAdFlow() {
            if (isAdStarted) return;
            isAdStarted = true;

            // 1. Calculate Target Time (Abhi ka time + 30 seconds)
            // Date.now() gives milliseconds, so we add 30 * 1000
            endTime = Date.now() + (REQUIRED_TIME * 1000);

            // 2. Open Ad
            window.open(ADSTERRA_LINK, '_blank');

            // 3. Update UI
            playBtn.style.display = "none";
            document.getElementById("player-msg").innerText = "Checking...";
            playerBox.style.opacity = "0.3";
            playerBox.style.pointerEvents = "none";
            timerBox.style.display = "block";

            // 4. Start Clock Checker
            timerInterval = setInterval(checkTime, 500); // Check every half second
        }

        function checkTime() {
            // Abhi ka time nikalo
            const now = Date.now();
            
            // Kitna time bacha hai? (Target - Abhi)
            const remaining = Math.ceil((endTime - now) / 1000);

            if (remaining <= 0) {
                // Time Pura Ho Gaya!
                clearInterval(timerInterval);
                timeSpan.innerText = "0";
                statusText.innerText = "Completed!";
                statusText.style.color = "#4CAF50";
                
                // Show Input
                setTimeout(() => {
                    timerBox.style.display = "none";
                    playerBox.style.display = "none";
                    restartBtn.style.display = "none"; // Hide restart on success
                    inputSection.style.display = "block";
                }, 1000);
            } else {
                // Time Bacha Hai
                timeSpan.innerText = remaining;
                
                // Check if user is looking at page or not
                if (document.hidden) {
                    statusText.innerText = "Watching Ad... (Good)";
                    statusText.style.color = "#4CAF50";
                    timerBox.style.borderColor = "#4CAF50";
                } else {
                    // User wapas aa gaya lekin time bacha hai
                    // Calculat kitna time wait kiya
                    const waited = REQUIRED_TIME - remaining;
                    statusText.innerHTML = `<span class="error-text">‚ùå Too Early! You only waited ${waited}s.<br>Go back to Ad or Wait here ${remaining}s more.</span>`;
                    timerBox.style.borderColor = "red";
                }
            }
        }

        function submitLink() {
            let link = document.getElementById("userLink").value;
            if (!link || link.length < 3) {
                alert("Please paste a link first!");
                return;
            }
            let cleanLink = link.replace("https://t.me/", "").replace("@", "");
            const tg = window.Telegram.WebApp;
            tg.openTelegramLink(`https://t.me/${BOT_USERNAME}?start=${cleanLink}`);
            tg.close();
        }

        window.Telegram.WebApp.expand();
    </script>

</body>
</html>
